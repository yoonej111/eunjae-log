# ⛓️ 체인링크 VRF 컨트랙트: 심층 분석 


체인링크는 VRF는 2년 가까이 제가 속해있던 팀에서 써오던 서비스라 익숙한 편입니다. 처음에 체인링크 VRF를 접하면서 간단한 스터디를 진행하기는 했지만 예쁘게? 정리해둔 문서가 없어서 CCIP 를 공부하는 김에 VRF 컨트랙트도 가볍게 살펴보고자 합니다. 
체인링크 VRF는 Verified Random Function 으로 간단히 말해 블록체인 상에서 검증 가능한 랜덤 난수를 제공하는 서비스입니다. 이는 블록체인 상에서 랜덤 난수를 필요로 하는 DeFi, 확률 아이템을 가지고 있는 게임, NFT 등 다양한 분야에서 사용할 수 있습니다.

그럼 왜 랜덤 난수 생성을 위해 체인링크 VRF 를 사용해야 할까요? 블록체인 랜덤 난수 생성에는 몇 가지 문제점이 있기 때문입니다. 
1) 첫 째로, 예측 가능성입니다. 블록체인은 투명성과 공개성을 중시하기 때문에 모든 트랜잭션과 블록 정보가 공개됩니다. 이로 인해, 만약 특정한 알고리즘이나 메서드를 통해 랜덤 난수가 생성된다면 그 과정을 분석해 난수를 예측할 가능성이 생기게 됩니다.
2) 두 번째는, 조작 가능성입니다. 블록체인은 분산 시스템으로, 각 노드는 블록을 생성할 때 경제적 인센티브를 받게 됩니다. 만약 블록 생성 과정에서 특정 난수 값이 유리하게 작용할 수 있다면, 채굴자들은 자신에게 유리한 난수를 생성하기 위해 블록을 조작할 수 있습니다.

keccak 함수를 사용하여 솔리디티 자체적으로 난수 생성이 불가능한 것은 아니지만 예측 가능한 랜덤 난수는, 난수의 기능을 하지 못한다고도 볼 수 있을 것 같습니다. 

이제 체인링크 VRF 컨트랙트를 살펴보도록 하겠습니다. 체인링크 VRF 컨트랙트는 두 가지 주요 컨트랙트(COORDINATOR, CONSUMER)로 구성되어 있습니다.

#### 1. VRF COORDINATOR

VRFCoordinatorV2.sol 컨트랙트는은 VRF 요청과 이행을 관리하는 체인링크의 스마트 컨트랙트입니다. 이는 VRF 요청을 처리하고, 결과를 검증하며, LINK 토큰을 통해 비용을 관리하며, 주요 기능은 아래와 같습니다.

* **난수 생성:** 난수 생성 알고리즘을 사용하여 난수를 생성한다.
* **요청 관리:** 여러 VRF Consumer 컨트랙트로부터 난수 요청을 관리하고 처리한다.
* **응답 전송:** 생성된 난수와 난수 생성 과정을 증명하는 데이터를 VRF Consumer 컨트랙트에 전송한다.
* **오라클 네트워크 관리:** 탈중앙화 오라클 네트워크를 관리하고, 난수 생성 과정의 투명성을 보장한다.
* **보안 관리:** 난수 생성 과정의 보안을 유지하고, 악의적인 행위를 방지한다.

그럼 코드를 하나하나 뜯어 보면서 위 기능들을 살펴보도록 하겠습니다. 코드는 아래 github 에서 확인 가능합니다.
[VRF Coorinator Github Link](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/vrf/VRFCoordinatorV2.sol)





```javascript
console.log('hi');
console.log('hi2');
```
